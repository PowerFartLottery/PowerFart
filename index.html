<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PowerFart</title>
  <link href="https://fonts.googleapis.com/css2?family=Fira+Code&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Fira Code', monospace;
      background-color: #0d0d0d;
      color: #00ff99;
      text-align: center;
      margin: 0;
      padding: 0;
    }
    header {
      padding: 20px;
    }
    h1 {
      font-size: 2.5rem;
      margin: 10px 0;
    }
    h2 {
      margin-top: 40px;
      font-size: 1.5rem;
    }
    ul {
      list-style-type: none;
      padding: 0;
    }
    li {
      margin: 8px 0;
    }
    a {
      color: #00ccff;
      text-decoration: none;
    }
    a:hover {
      text-decoration: underline;
    }
    .error {
      color: red;
    }
  </style>
</head>
<body>
  <header>
    <img src="logo.png" alt="PowerFart Logo" width="150" />
    <h1>PowerFart Lottery</h1>
  </header>

  <main>
    <h2>Previous Winners</h2>
    <ul id="winners">
      <li>Loading winners...</li>
    </ul>
  </main>

  <script>
    const SOLSCAN_API_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJjcmVhdGVkQXQiOjE3NDkwMzE5Njg3NDYsImVtYWlsIjoiNjlkaWNrd2hpdG1hbjY5QGdtYWlsLmNvbSIsImFjdGlvbiI6InRva2VuLWFwaSIsImFwaVZlcnNpb24iOiJ2MiIsImlhdCI6MTc0OTAzMTk2OH0.x48lrxd3sM8UXKT54aOfzwmN4dZ3c59rptXkRuWJVCY"; 
    const MIN_AMOUNT = 10;

    async function fetchWinners() {
      try {
        const res = await fetch(
          `https://pro-api.solscan.io/v2.0/token/transfer?account=${TEAM_WALLET}&token=${FARTCOIN_TOKEN}&limit=50`,
          { headers: { token: SOLSCAN_API_KEY } }
        );
        if (!res.ok) throw new Error("Failed API call " + res.status);
        const data = await res.json();

        const transfers = data.data || [];
        const list = document.getElementById("winners");
        list.innerHTML = "";

        const outgoing = transfers.filter(t =>
          t.source === TEAM_WALLET &&
          parseFloat(t.amount) >= MIN_AMOUNT
        );

        if (outgoing.length === 0) {
          list.innerHTML = "<li>No winners yet</li>";
          return;
        }

        outgoing.forEach(t => {
          const li = document.createElement("li");
          li.innerHTML = `
            <a href="https://solscan.io/account/${t.destination}" target="_blank">
              ${t.destination}
            </a> - 
            ${parseFloat(t.amount).toFixed(2)} FART 
            <a href="https://solscan.io/tx/${t.txHash}" target="_blank">ðŸ”—</a>
          `;
          list.appendChild(li);
        });
      } catch (err) {
        console.error(err);
        document.getElementById("winners").innerHTML =
          `<li class="error">Error loading winners: ${err.message}</li>`;
      }
    }

    document.addEventListener("DOMContentLoaded", fetchWinners);
  </script>
</body>
</html>
