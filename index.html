<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PowerFart</title>
  <link href="https://fonts.googleapis.com/css2?family=Fira+Code&display=swap" rel="stylesheet" />
  <style>
    /* Styles omitted for brevity; retain the ones from your current setup */
  </style>
</head>
<body>
  <!-- Boot Screen -->
  <div id="bootScreen">
    <div id="bootText">POWERFART TECHNOLOGIESÂ® 2025</div>
    <div id="loadingBarContainer">
      <div style="color: #0f0; margin-bottom: 0.3rem;">PowerFart Technologies Â® Loading</div>
      <div id="loadingBar"></div>
    </div>
    <div id="cursor"></div>
  </div>

  <!-- Fart Button -->
  <div class="fart-wrapper">
    <button id="fartButton" aria-label="Launch PowerFart">
PowerFartâ„¢ v4.2.0  
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  
Â© 2025 PowerFart Technologies  
Created by Fartoshi Shartamoto  
First release: June 5, 2025  
    </button>
  </div>

  <!-- Jackpot & Countdown -->
  <div class="section">
    <h2>Next Winner In</h2>
    <div id="countdown">--:--</div>
    <h2>Jackpot</h2>
    <div id="jackpot">Loading...</div>
  </div>

  <!-- Winners Section -->
  <div class="section">
    <h2>Previous Winners</h2>
    <ul id="winners"><li>Loading...</li></ul>
  </div>

  <!-- Contract Address -->
  <pre id="contractAddress" title="Click to copy"><code>
<span class="comment">// Contract Address:</span>
<span class="string">CpG2Tc1EP5jZJf7bjns5faGD6qDaKbCbvEbRUh5EHZ9a</span>
</code></pre>

  <!-- Audio -->
  <audio id="bootSound" preload="auto">
    <source src="https://upload.wikimedia.org/wikipedia/en/1/1f/Windows_XP_Startup_sound.ogg" type="audio/ogg" />
  </audio>
  <audio id="fartSound" src="https://www.myinstants.com/media/sounds/fart-with-reverb.mp3"></audio>

  <!-- Scripts -->
  <script>
    const bootScreen = document.getElementById('bootScreen');
    const bootText = document.getElementById('bootText');
    const loadingBar = document.getElementById('loadingBar');
    const cursor = document.getElementById('cursor');
    const bootSound = document.getElementById('bootSound');

    const bootMessages = [
      "PowerFart OS v4.2.0 initializing...",
      "Loading core modules...",
      "Establishing Fartcoin blockchain link...",
      "Verifying wallet balances...",
      "Checking fart emission levels...",
      "Calibrating gas sensors...",
      "Ready. Enjoy the power of the fart!",
      "PowerFart TechnologiesÂ® 2025 "
    ];

    let lineIndex = 0;
    let skipBoot = false;

    function typeLine(line, callback) {
      let i = 0;
      function typeChar() {
        if (skipBoot) {
          bootText.textContent += line + "\n";
          callback();
          return;
        }
        if (i < line.length) {
          bootText.textContent += line.charAt(i);
          i++;
          setTimeout(typeChar, 40);
        } else {
          bootText.textContent += "\n";
          callback();
        }
      }
      typeChar();
    }

    function nextLine() {
      if (skipBoot) return finishBoot();
      if (lineIndex < bootMessages.length) {
        const progress = Math.floor((lineIndex / (bootMessages.length - 1)) * 100);
        loadingBar.style.width = progress + '%';
        typeLine(bootMessages[lineIndex], () => {
          lineIndex++;
          setTimeout(nextLine, 200);
        });
      } else {
        finishBoot();
      }
    }

    function finishBoot() {
      loadingBar.style.width = '100%';
      cursor.style.display = 'none';
      bootSound.play();
      bootScreen.style.transition = "opacity 1.5s ease";
      bootScreen.style.opacity = 0;
      setTimeout(() => {
        bootScreen.style.display = "none";
      }, 1600);
    }

    bootScreen.addEventListener('click', () => {
      if (!skipBoot) {
        skipBoot = true;
        finishBoot();
      }
    });

    window.addEventListener('load', () => {
      nextLine();
    });

    const fartButton = document.getElementById('fartButton');
    const fartSound = document.getElementById('fartSound');

    fartButton.addEventListener('click', () => {
      fartSound.currentTime = 0;
      fartSound.play();
      const fartCloud = document.createElement('div');
      fartCloud.classList.add('fart-cloud');
      fartCloud.textContent = 'ðŸ’¨ðŸ’¥ðŸ’¨';
      const rect = fartButton.getBoundingClientRect();
      fartCloud.style.left = (rect.left + rect.width / 2) + 'px';
      fartCloud.style.bottom = '80px';
      fartCloud.style.position = 'fixed';
      document.body.appendChild(fartCloud);
      fartCloud.addEventListener('animationend', () => fartCloud.remove());
    });

    document.getElementById('contractAddress').addEventListener('click', () => {
      const address = document.getElementById('contractAddress').innerText.trim().split('\n').pop().trim();
      navigator.clipboard.writeText(address).then(() => {
        fartSound.currentTime = 0;
        fartSound.play();
      });
    });

    const HELIUS_API_KEY = "c698448b-867d-4b89-8d94-86c6dd939233";
    const HELIUS_URL = `https://mainnet.helius-rpc.com/?api-key=${HELIUS_API_KEY}`;
    const TEAM_WALLET = "6cPZe9GFusuZ9rW48FZPMc6rq318FT8PvGCX7WqG47YE";
    const FARTCOIN_TOKEN = "9BB6NFEcjBCtnNLFko2FqVQBq8HHM13kCyYcdQbgpump";
    const FARTCOIN_DECIMALS = 6;

    function updateCountdown() {
      const countdownEl = document.getElementById('countdown');
      const now = new Date();
      const nextHour = new Date(now);
      nextHour.setMinutes(0, 0, 0);
      nextHour.setHours(now.getHours() + 1);
      const diff = nextHour - now;
      if (diff <= 0) return countdownEl.textContent = "00:00";
      const minutes = Math.floor(diff / 60000);
      const seconds = Math.floor((diff % 60000) / 1000);
      countdownEl.textContent = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
    }
    setInterval(updateCountdown, 1000);
    updateCountdown();

    async function fetchFartcoinBalance() {
      try {
        const res = await fetch(HELIUS_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            jsonrpc: "2.0",
            id: 1,
            method: "getTokenAccountsByOwner",
            params: [TEAM_WALLET, { mint: FARTCOIN_TOKEN }, { encoding: "jsonParsed" }]
          })
        });
        const data = await res.json();
        let totalAmount = 0n;
        for (const account of data.result.value) {
          const amountStr = account.account.data.parsed.info.tokenAmount.amount;
          totalAmount += BigInt(amountStr);
        }
        const totalFartcoin = Number(totalAmount) / Math.pow(10, FARTCOIN_DECIMALS);
        document.getElementById("jackpot").textContent = totalFartcoin.toLocaleString(undefined, {
          minimumFractionDigits: 2,
          maximumFractionDigits: 2
        }) + " FART";
      } catch (err) {
        console.error("Failed to fetch fartcoin balance:", err);
        document.getElementById("jackpot").textContent = "Error loading balance";
      }
    }
    fetchFartcoinBalance();

    fetch('https://gist.githubusercontent.com/PowerFartLottery/705e19a1ed3b616ec338f77e4bd80dc7/raw/winners.json')
      .then(res => res.json())
      .then(data => {
        const list = document.getElementById('winners');
        list.innerHTML = '';
        if (data.length === 0) {
          list.innerHTML = '<li>No winners yet</li>';
        } else {
          data.forEach(w => {
            const li = document.createElement('li');
            li.innerHTML = `<a href="https://solscan.io/account/${w.address}" target="_blank">${w.address}</a> - ${w.amount.toFixed(2)} FART <a href="${w.tx}" target="_blank">ðŸ”—</a>`;
            list.appendChild(li);
          });
        }
      })
      .catch(err => {
        console.error(err);
        document.getElementById('winners').innerHTML = '<li>Error loading winners</li>';
      });
  </script>
</body>
</html>
